--
-- Script was generated by Devart dbForge Studio for Oracle, Version 3.7.472.0
-- Product home page: http://www.devart.com/dbforge/oracle/studio
-- Script date 2015.03.23. 18:05:21
-- Server version: Oracle Database 11g Enterprise Edition Release 11.2.0.1.0 - 64bit Production With the Partitioning, Oracle Label Security, OLAP, Data Mining, Oracle Database Vault and Real Application Testing options
-- Client version: 12.1.0.0
-- Please backup your database before running this script
--

--
-- Alter column "FROM_DATE" on table "OBH_TEST.SUBJECT"
--
UPDATE SUBJECT SET FROM_DATE=SYSDATE;
ALTER TABLE SUBJECT
  MODIFY(FROM_DATE DEFAULT SYSDATE  NOT NULL);

--
-- Alter column "TO_DATE" on table "OBH_TEST.SUBJECT"
--
UPDATE SUBJECT SET TO_DATE=TO_DATE('2099.12.31. 23:59:59','YYYY.MM.DD. HH24:MI:SS');
ALTER TABLE SUBJECT
  MODIFY(TO_DATE DEFAULT TO_DATE('2099.12.31. 23:59:59','YYYY.MM.DD. HH24:MI:SS')  NOT NULL);

--
-- Create column "ROLL_TYPE" on table "OBH_TEST.SUBJECT"
--
ALTER TABLE SUBJECT
  ADD ROLL_TYPE NUMBER(*, 0) DEFAULT 1;

--
-- Create column "ROLL_TYPE" on table "OBH_TEST.DM_SUPER_TYP"
--
ALTER TABLE DM_SUPER_TYP
  ADD ROLL_TYPE NUMBER(*, 0) DEFAULT 1;

--
-- Alter column "FROM_DATE" on table "OBH_TEST.DM_SUPER_TYP"
--
UPDATE DM_SUPER_TYP SET FROM_DATE=SYSDATE;
ALTER TABLE DM_SUPER_TYP
  MODIFY(FROM_DATE DEFAULT SYSDATE  NOT NULL);

--
-- Alter column "TO_DATE" on table "OBH_TEST.DM_SUPER_TYP"
--
UPDATE DM_SUPER_TYP SET TO_DATE=TO_DATE('2099.12.31. 23:59:59','YYYY.MM.DD. HH24:MI:SS');
ALTER TABLE DM_SUPER_TYP
  MODIFY(TO_DATE DEFAULT TO_DATE('2099.12.31. 23:59:59','YYYY.MM.DD. HH24:MI:SS')  NOT NULL);

--
-- Create column "WIRED_TO" on table "OBH_TEST.DM_SUPER_TYP"
--
ALTER TABLE OBH_TEST.DM_SUPER_TYP
  ADD WIRED_TO NVARCHAR2(255);

ALTER TABLE DM_SUPER_TYP
  ADD ROLL_TYPE NUMBER(*, 0) DEFAULT 1;


--
-- Create trigger "OBH_TEST.TRG_SUBJECT"
--
CREATE OR REPLACE TRIGGER OBH_TEST.TRG_SUBJECT
BEFORE INSERT OR UPDATE ON OBH_TEST.SUBJECT FOR EACH ROW
BEGIN
  IF INSERTING
  THEN
    IF :new.SUBJ_ID IS NULL OR :new.SUBJ_ID = 0
    THEN
SELECT SEQ_BASE.NEXTVAL
  INTO :NEW.SUBJ_ID
  FROM DUAL;
   IF :new.FROM_DATE IS NULL THEN
      :new.FROM_DATE := SYSDATE;
   END IF;
   IF :NEW.TO_DATE IS NULL THEN
      :NEW.TO_DATE := TO_DATE('2099.12.31. 23:59:59','YYYY.MM.DD. HH24:MI:SS');
   END IF;
END IF;
    :new.CRD := SYSTIMESTAMP;
      --LÉTREHOZÁS IDŐPONTJA
    :NEW.CRU := NVL(V('APP_USER'), USER);
 --APEX USER AKI LÉTREHOZZA A REKORDOT
  ELSIF UPDATING
  THEN
    :new.MDD := SYSTIMESTAMP;
      --MÓDOSÍTÁS IDŐPONTJA
    :NEW.MDU := NVL(V('APP_USER'), USER);
 --APEX USER AKI MÓDOSÍT
  END IF;
END;